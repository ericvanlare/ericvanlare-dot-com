[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.16.14","content-config-digest","e994d988570a6ba2","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{\"light\":\"github-light\",\"dark\":\"github-dark\"},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12,55,56],"ai-site-modification-architecture",{"id":11,"data":13,"body":18,"filePath":19,"digest":20,"rendered":21,"legacyId":54},{"title":14,"date":15,"description":16,"featured":17},"Building an AI Site Modification API","January 2026","The technical architecture behind using GitHub Issues + Copilot + Cloudflare Workers as an AI-powered site editing API.",true,"GitHub Copilot will pick up any issue assigned to it, explore the repo, and open a PR. Cloudflare Pages builds every branch and gives you a preview URL. Put these together and you get an API for AI-powered site modifications: POST a description, get back a preview, approve or reject.\n\nHere's how I wired it up for this site.\n\n## The architecture\n\n```\nericvanlare.com (Cloudflare Pages)\n├── /admin → React panel, calls Worker API\n│\nericvanlare-api.workers.dev (Cloudflare Worker)\n├── POST /api/ai-mod/request  → Create issue, assign Copilot\n├── GET  /api/ai-mod/list     → List all requests + statuses\n├── POST /api/ai-mod/approve  → Merge the PR\n├── POST /api/ai-mod/reject   → Close the PR\n├── POST /api/ai-mod/revise   → Close old, create new issue with feedback\n└── POST /api/ai-mod/revert   → Create issue to undo merged changes\n```\n\nThe Worker is the glue. It talks to GitHub's API, tracks which issues have PRs, and constructs preview URLs from branch names.\n\n## The hard part: assigning Copilot\n\nYou can't just set `assignees: [\"copilot\"]` on an issue. Copilot is a bot, and GitHub's REST API won't accept bot usernames as assignees. You need the bot's internal node ID, which means GraphQL.\n\nFirst, query for actors that can be assigned to issues in your repo:\n\n```graphql\nquery($owner: String!, $name: String!) {\n  repository(owner: $owner, name: $name) {\n    suggestedActors(capabilities: [CAN_BE_ASSIGNED], first: 20) {\n      nodes {\n        login\n        __typename\n        ... on Bot { id }\n        ... on User { id }\n      }\n    }\n  }\n}\n```\n\nLook for the node where `login` is `\"copilot-swe-agent\"` and `__typename` is `\"Bot\"`. Grab its `id`.\n\nThen get the issue's node ID:\n\n```graphql\nquery($owner: String!, $name: String!, $number: Int!) {\n  repository(owner: $owner, name: $name) {\n    issue(number: $number) { id }\n  }\n}\n```\n\nFinally, assign the bot:\n\n```graphql\nmutation($issueId: ID!, $assigneeIds: [ID!]!) {\n  addAssigneesToAssignable(input: {\n    assignableId: $issueId,\n    assigneeIds: $assigneeIds\n  }) {\n    assignable { ... on Issue { id } }\n  }\n}\n```\n\nThis isn't documented anywhere obvious. I found it by poking around the GraphQL explorer and reading forum threads.\n\n## Matching issues to PRs\n\nCopilot creates a PR but doesn't give you a webhook or callback. You have to poll. The Worker fetches recent PRs and tries to match them to issues by:\n\n1. Branch name containing the issue number\n2. PR body containing \"fixes #N\" or \"closes #N\"\n\n```javascript\nconst linkedPr = prs.find(pr => {\n  // Check branch name\n  if (pr.head.ref.includes(issueNumber)) return true;\n  \n  // Check PR body for \"fixes #N\" pattern\n  if (pr.body) {\n    const pattern = new RegExp(\n      `(fixes|closes|resolves)\\\\s+.*#${issueNumber}\\\\b`, 'i'\n    );\n    if (pattern.test(pr.body)) return true;\n  }\n  return false;\n});\n```\n\nIt's fuzzy, but Copilot is consistent enough that it works.\n\n## Preview URLs\n\nCloudflare Pages preview URLs follow a predictable pattern:\n\n```\nhttps://{branch-slug}.{project}.pages.dev\n```\n\nThe branch slug is the branch name, lowercased, with slashes replaced by hyphens, truncated to 28 characters. The Worker constructs this URL and pings it with a HEAD request. If it responds, the preview is ready.\n\n```typescript\nasync function getPreviewUrl(branchRef: string) {\n  let slug = branchRef.replace(/\\//g, '-').toLowerCase();\n  if (slug.length > 28) slug = slug.substring(0, 28);\n  \n  const url = `https://${slug}.ericvanlare-dot-com.pages.dev`;\n  \n  const response = await fetch(url, { method: 'HEAD' });\n  return { url, ready: response.ok };\n}\n```\n\n## The revision flow\n\nWhat if the preview looks wrong? The naive approach would be to comment on the PR or the issue. But Copilot doesn't reliably pick up comments on existing issues.\n\nSo I went dumb: close the old issue, close the old PR, create a fresh issue with the original description plus new feedback. No state machine, no tracking thread. Each attempt is independent.\n\n```typescript\n// Close old PR\nawait github.patch(`/pulls/${prNumber}`, { state: 'closed' });\n\n// Close old issue\nawait github.patch(`/issues/${issueNumber}`, { state: 'closed' });\n\n// Create new issue with combined context\nawait github.post('/issues', {\n  title: `[AI] Revision: ${originalDescription}`,\n  body: `## Original request\\n${originalDescription}\\n\\n## Feedback\\n${feedback}`,\n  labels: ['ai-modification'],\n});\n// Then assign Copilot...\n```\n\nIt's wasteful—you end up with a trail of closed issues and PRs—but it's simple and it works.\n\n## The admin UI\n\nThe frontend is a React component that:\n\n- Lists all requests with their current status\n- Shows the preview in an iframe when ready\n- Provides approve/reject/revise buttons\n- Has a textarea for revision feedback\n\nStatus is derived from the issue and PR state: pending (no PR yet), building (PR exists but preview 404s), preview_ready (preview responds), applied (PR merged), discarded (PR closed without merge).\n\n## What I'd do differently\n\n**Webhooks instead of polling.** GitHub can POST to your Worker when issues or PRs change. I didn't set this up because polling was simpler to debug, but it would make the UI feel more responsive.\n\n**Store state in KV.** Right now the Worker reconstructs everything from GitHub's API on each request. A KV cache would reduce API calls and let me track things GitHub doesn't expose, like \"this issue was a revision of that one.\"\n\n**Better error handling.** If Copilot doesn't pick up an issue (it happens), there's no retry mechanism. The request just sits in \"pending\" forever.\n\n## Is it worth building?\n\nIf you have a simple static site and want to experiment with AI-assisted editing, yes. The whole thing is about 500 lines of Worker code and 300 lines of React. It took an afternoon to build.\n\nThe real value isn't the automation—it's the workflow. Having a dedicated place to submit changes, see previews, and approve or reject forces a review step that \"just push to main\" doesn't have. The AI is almost incidental; the structure is what matters.","src/content/blog/ai-site-modification-architecture.md","e583118d6de32532",{"html":22,"metadata":23},"\u003Cp>GitHub Copilot will pick up any issue assigned to it, explore the repo, and open a PR. Cloudflare Pages builds every branch and gives you a preview URL. Put these together and you get an API for AI-powered site modifications: POST a description, get back a preview, approve or reject.\u003C/p>\n\u003Cp>Here’s how I wired it up for this site.\u003C/p>\n\u003Ch2 id=\"the-architecture\">The architecture\u003C/h2>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>ericvanlare.com (Cloudflare Pages)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>├── /admin → React panel, calls Worker API\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>ericvanlare-api.workers.dev (Cloudflare Worker)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>├── POST /api/ai-mod/request  → Create issue, assign Copilot\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>├── GET  /api/ai-mod/list     → List all requests + statuses\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>├── POST /api/ai-mod/approve  → Merge the PR\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>├── POST /api/ai-mod/reject   → Close the PR\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>├── POST /api/ai-mod/revise   → Close old, create new issue with feedback\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>└── POST /api/ai-mod/revert   → Create issue to undo merged changes\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The Worker is the glue. It talks to GitHub’s API, tracks which issues have PRs, and constructs preview URLs from branch names.\u003C/p>\n\u003Ch2 id=\"the-hard-part-assigning-copilot\">The hard part: assigning Copilot\u003C/h2>\n\u003Cp>You can’t just set \u003Ccode>assignees: [\"copilot\"]\u003C/code> on an issue. Copilot is a bot, and GitHub’s REST API won’t accept bot usernames as assignees. You need the bot’s internal node ID, which means GraphQL.\u003C/p>\n\u003Cp>First, query for actors that can be assigned to issues in your repo:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"graphql\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">query\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$owner\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">String\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">!\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$name\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">String\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">!\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">  repository\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">owner\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$owner\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">name\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$name\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">    suggestedActors\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">capabilities\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: [\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">CAN_BE_ASSIGNED\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">], \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">first\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">20\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">      nodes\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">        login\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">        __typename\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">        ...\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> on\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> Bot\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">id\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">        ...\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> on\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> User\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">id\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Look for the node where \u003Ccode>login\u003C/code> is \u003Ccode>\"copilot-swe-agent\"\u003C/code> and \u003Ccode>__typename\u003C/code> is \u003Ccode>\"Bot\"\u003C/code>. Grab its \u003Ccode>id\u003C/code>.\u003C/p>\n\u003Cp>Then get the issue’s node ID:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"graphql\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">query\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$owner\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">String\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">!\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$name\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">String\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">!\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$number\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">Int\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">!\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">  repository\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">owner\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$owner\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">name\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$name\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">    issue\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">number\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$number\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) { \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">id\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Finally, assign the bot:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"graphql\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">mutation\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$issueId\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">ID\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">!\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$assigneeIds\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: [\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">ID\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">!\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">]\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">!\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">  addAssigneesToAssignable\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">input\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">    assignableId\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$issueId\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">    assigneeIds\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">$assigneeIds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  }) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">    assignable\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">...\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> on\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> Issue\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">id\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> } }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This isn’t documented anywhere obvious. I found it by poking around the GraphQL explorer and reading forum threads.\u003C/p>\n\u003Ch2 id=\"matching-issues-to-prs\">Matching issues to PRs\u003C/h2>\n\u003Cp>Copilot creates a PR but doesn’t give you a webhook or callback. You have to poll. The Worker fetches recent PRs and tries to match them to issues by:\u003C/p>\n\u003Col>\n\u003Cli>Branch name containing the issue number\u003C/li>\n\u003Cli>PR body containing “fixes #N” or “closes #N”\u003C/li>\n\u003C/ol>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"javascript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">const\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> linkedPr\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> prs.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">find\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">pr\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =>\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">  // Check branch name\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  if\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> (pr.head.ref.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">includes\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(issueNumber)) \u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">return\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> true\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">  // Check PR body for \"fixes #N\" pattern\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  if\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> (pr.body) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">    const\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> pattern\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> new\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> RegExp\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">      `(fixes|closes|resolves)\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">\\\\\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">s+.*#${\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">issueNumber\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">\\\\\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">b`\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">'i'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">    if\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> (pattern.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">test\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(pr.body)) \u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">return\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> true\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  return\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> false\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>It’s fuzzy, but Copilot is consistent enough that it works.\u003C/p>\n\u003Ch2 id=\"preview-urls\">Preview URLs\u003C/h2>\n\u003Cp>Cloudflare Pages preview URLs follow a predictable pattern:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>https://{branch-slug}.{project}.pages.dev\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The branch slug is the branch name, lowercased, with slashes replaced by hyphens, truncated to 28 characters. The Worker constructs this URL and pings it with a HEAD request. If it responds, the preview is ready.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">async\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> function\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> getPreviewUrl\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">branchRef\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">:\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  let\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> slug \u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">=\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> branchRef.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">replace\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">/\u003C/span>\u003Cspan style=\"color:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold\">\\/\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">/\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">g\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">'-'\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">).\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">toLowerCase\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  if\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> (slug.\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">length\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> >\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> 28\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">) slug \u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">=\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> slug.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">substring\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">28\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  const\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> url\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\"> `https://${\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">slug\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}.ericvanlare-dot-com.pages.dev`\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  const\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\"> response\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\"> await\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\"> fetch\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(url, { method: \u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">'HEAD'\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">  return\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> { url, ready: response.ok };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"the-revision-flow\">The revision flow\u003C/h2>\n\u003Cp>What if the preview looks wrong? The naive approach would be to comment on the PR or the issue. But Copilot doesn’t reliably pick up comments on existing issues.\u003C/p>\n\u003Cp>So I went dumb: close the old issue, close the old PR, create a fresh issue with the original description plus new feedback. No state machine, no tracking thread. Each attempt is independent.\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">// Close old PR\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">await\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> github.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">patch\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">`/pulls/${\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">prNumber\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}`\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, { state: \u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">'closed'\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">// Close old issue\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">await\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> github.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">patch\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">`/issues/${\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">issueNumber\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}`\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, { state: \u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">'closed'\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">// Create new issue with combined context\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">await\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> github.\u003C/span>\u003Cspan style=\"color:#6F42C1;--shiki-dark:#B392F0\">post\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">'/issues'\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  title: \u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">`[AI] Revision: ${\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">originalDescription\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}`\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  body: \u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">`## Original request\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">\\n\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">${\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">originalDescription\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">\\n\\n\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">## Feedback\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">\\n\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">${\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">feedback\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">}`\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  labels: [\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">'ai-modification'\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">],\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D;--shiki-dark:#6A737D\">// Then assign Copilot...\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>It’s wasteful—you end up with a trail of closed issues and PRs—but it’s simple and it works.\u003C/p>\n\u003Ch2 id=\"the-admin-ui\">The admin UI\u003C/h2>\n\u003Cp>The frontend is a React component that:\u003C/p>\n\u003Cul>\n\u003Cli>Lists all requests with their current status\u003C/li>\n\u003Cli>Shows the preview in an iframe when ready\u003C/li>\n\u003Cli>Provides approve/reject/revise buttons\u003C/li>\n\u003Cli>Has a textarea for revision feedback\u003C/li>\n\u003C/ul>\n\u003Cp>Status is derived from the issue and PR state: pending (no PR yet), building (PR exists but preview 404s), preview_ready (preview responds), applied (PR merged), discarded (PR closed without merge).\u003C/p>\n\u003Ch2 id=\"what-id-do-differently\">What I’d do differently\u003C/h2>\n\u003Cp>\u003Cstrong>Webhooks instead of polling.\u003C/strong> GitHub can POST to your Worker when issues or PRs change. I didn’t set this up because polling was simpler to debug, but it would make the UI feel more responsive.\u003C/p>\n\u003Cp>\u003Cstrong>Store state in KV.\u003C/strong> Right now the Worker reconstructs everything from GitHub’s API on each request. A KV cache would reduce API calls and let me track things GitHub doesn’t expose, like “this issue was a revision of that one.”\u003C/p>\n\u003Cp>\u003Cstrong>Better error handling.\u003C/strong> If Copilot doesn’t pick up an issue (it happens), there’s no retry mechanism. The request just sits in “pending” forever.\u003C/p>\n\u003Ch2 id=\"is-it-worth-building\">Is it worth building?\u003C/h2>\n\u003Cp>If you have a simple static site and want to experiment with AI-assisted editing, yes. The whole thing is about 500 lines of Worker code and 300 lines of React. It took an afternoon to build.\u003C/p>\n\u003Cp>The real value isn’t the automation—it’s the workflow. Having a dedicated place to submit changes, see previews, and approve or reject forces a review step that “just push to main” doesn’t have. The AI is almost incidental; the structure is what matters.\u003C/p>",{"headings":24,"localImagePaths":50,"remoteImagePaths":51,"frontmatter":52,"imagePaths":53},[25,29,32,35,38,41,44,47],{"depth":26,"slug":27,"text":28},2,"the-architecture","The architecture",{"depth":26,"slug":30,"text":31},"the-hard-part-assigning-copilot","The hard part: assigning Copilot",{"depth":26,"slug":33,"text":34},"matching-issues-to-prs","Matching issues to PRs",{"depth":26,"slug":36,"text":37},"preview-urls","Preview URLs",{"depth":26,"slug":39,"text":40},"the-revision-flow","The revision flow",{"depth":26,"slug":42,"text":43},"the-admin-ui","The admin UI",{"depth":26,"slug":45,"text":46},"what-id-do-differently","What I’d do differently",{"depth":26,"slug":48,"text":49},"is-it-worth-building","Is it worth building?",[],[],{"title":14,"date":15,"description":16,"featured":17},[],"ai-site-modification-architecture.md","designing-a-diagramming-agent",{"id":55,"data":57,"body":60,"filePath":61,"digest":62,"rendered":63,"legacyId":93},{"title":58,"date":15,"description":59,"pinned":17},"A Prompt for Grounded Codebase Diagrams","AI diagrams are useless if you can't click them. Here's a prompt that generates diagrams where every node links to real code.","AI is writing more of our code every day. You leave an agent running, come back, and who knows what's changed. Having a map helps.\n\nThe problem is most AI-generated diagrams are useless. Boxes labeled \"AuthService\" and \"DatabaseLayer\" — but click on them and nothing happens. You can't tell if \"PaymentProcessor\" is a class, a file, or something the model hallucinated.\n\nThe fix is simple: **ground every node in actual code**. Each box maps to a file and line range. Now the diagram isn't decoration — it's a navigation surface.\n\n## The prompt\n\nHere's what works. Paste this into Claude Code, Amp, Cursor, or any coding agent:\n\n```\nPlease generate a mermaid diagram (in a .mmd file) that shows this codebase as an ontology. Make it comprehensive.\n\nEvery single node should be groundable in a specific line of code, set of lines from a file, or sets of lines from multiple files.\n\nGenerate that mapping as well and put it in a separate .naiad file — a JSON object where keys are node IDs and values are objects with \"file\" and \"lines\" properties.\n```\n\nThe key insight: by asking for the grounding file separately, you force the agent to actually verify each node corresponds to real code. No more hallucinated boxes.\n\n## What you get\n\nTwo files. First, a standard Mermaid diagram:\n\n```mermaid\nflowchart TD\n    auth[AuthService]\n    db[DatabaseLayer]\n    pay[PaymentProcessor]\n    \n    auth --> db\n    auth --> pay\n    pay --> db\n```\n\nSecond, a grounding file that maps each node to code:\n\n```json\n{\n  \"auth\": {\n    \"file\": \"src/auth/service.ts\",\n    \"lines\": [1, 145]\n  },\n  \"db\": {\n    \"file\": \"src/db/index.ts\",\n    \"lines\": [1, 89]\n  },\n  \"pay\": {\n    \"file\": \"src/payments/processor.ts\",\n    \"lines\": [12, 203]\n  }\n}\n```\n\n## Three ways to use this\n\n### 1. Paste the prompt\n\nCopy the prompt above into any coding agent. Works immediately.\n\n### 2. Shell alias\n\nAdd this to your shell config for one-command diagrams:\n\n```bash\nalias diagram='claude -p \"Generate a mermaid diagram (.mmd) showing this codebase as an ontology. Every node must map to real code. Generate a .naiad file with the grounding: JSON object, keys are node IDs, values have file and lines properties.\"'\n```\n\nReplace `claude` with `amp` or your agent of choice.\n\n### 3. Agent skill (Amp/Claude Code)\n\nFor agents that support skills, create a `SKILL.md` file in your repo:\n\n```markdown\n---\nname: diagram\ndescription: Generate a grounded codebase diagram\n---\n\nGenerate a comprehensive mermaid diagram showing this codebase as an ontology.\n\nRequirements:\n- Output a .mmd file with the Mermaid diagram\n- Every node must correspond to actual code\n- Output a .naiad file with grounding metadata\n- The .naiad file is JSON: keys are node IDs, values are {file, lines}\n\nStart by exploring the codebase structure, then build the diagram iteratively.\n```\n\n## Why this works\n\nMost \"diagram my codebase\" prompts fail because they don't constrain the output. The agent draws whatever looks reasonable, with no accountability.\n\nBy requiring a separate grounding file, you create a verification mechanism. The agent has to commit to specific file paths and line numbers. If it can't find real code to back a node, it either drops the node or the discrepancy becomes obvious.\n\nThe result: diagrams you can actually use to navigate a codebase, not just admire once and forget.","src/content/blog/designing-a-diagramming-agent.md","98ed6f832d08c6ff",{"html":64,"metadata":65},"\u003Cp>AI is writing more of our code every day. You leave an agent running, come back, and who knows what’s changed. Having a map helps.\u003C/p>\n\u003Cp>The problem is most AI-generated diagrams are useless. Boxes labeled “AuthService” and “DatabaseLayer” — but click on them and nothing happens. You can’t tell if “PaymentProcessor” is a class, a file, or something the model hallucinated.\u003C/p>\n\u003Cp>The fix is simple: \u003Cstrong>ground every node in actual code\u003C/strong>. Each box maps to a file and line range. Now the diagram isn’t decoration — it’s a navigation surface.\u003C/p>\n\u003Ch2 id=\"the-prompt\">The prompt\u003C/h2>\n\u003Cp>Here’s what works. Paste this into Claude Code, Amp, Cursor, or any coding agent:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>Please generate a mermaid diagram (in a .mmd file) that shows this codebase as an ontology. Make it comprehensive.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>Every single node should be groundable in a specific line of code, set of lines from a file, or sets of lines from multiple files.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>Generate that mapping as well and put it in a separate .naiad file — a JSON object where keys are node IDs and values are objects with \"file\" and \"lines\" properties.\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The key insight: by asking for the grounding file separately, you force the agent to actually verify each node corresponds to real code. No more hallucinated boxes.\u003C/p>\n\u003Ch2 id=\"what-you-get\">What you get\u003C/h2>\n\u003Cp>Two files. First, a standard Mermaid diagram:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"mermaid\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">flowchart TD\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    auth[AuthService]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    db[DatabaseLayer]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    pay[PaymentProcessor]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    auth --> db\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    auth --> pay\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">    pay --> db\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Second, a grounding file that maps each node to code:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"json\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">  \"auth\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"file\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"src/auth/service.ts\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"lines\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: [\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">145\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">  \"db\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"file\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"src/db/index.ts\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"lines\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: [\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">89\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">  \"pay\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"file\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">\"src/payments/processor.ts\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">    \"lines\"\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">: [\u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">12\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#005CC5;--shiki-dark:#79B8FF\">203\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"three-ways-to-use-this\">Three ways to use this\u003C/h2>\n\u003Ch3 id=\"1-paste-the-prompt\">1. Paste the prompt\u003C/h3>\n\u003Cp>Copy the prompt above into any coding agent. Works immediately.\u003C/p>\n\u003Ch3 id=\"2-shell-alias\">2. Shell alias\u003C/h3>\n\u003Cp>Add this to your shell config for one-command diagrams:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">alias\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> diagram\u003C/span>\u003Cspan style=\"color:#D73A49;--shiki-dark:#F97583\">=\u003C/span>\u003Cspan style=\"color:#032F62;--shiki-dark:#9ECBFF\">'claude -p \"Generate a mermaid diagram (.mmd) showing this codebase as an ontology. Every node must map to real code. Generate a .naiad file with the grounding: JSON object, keys are node IDs, values have file and lines properties.\"'\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Replace \u003Ccode>claude\u003C/code> with \u003Ccode>amp\u003C/code> or your agent of choice.\u003C/p>\n\u003Ch3 id=\"3-agent-skill-ampclaude-code\">3. Agent skill (Amp/Claude Code)\u003C/h3>\n\u003Cp>For agents that support skills, create a \u003Ccode>SKILL.md\u003C/code> file in your repo:\u003C/p>\n\u003Cpre class=\"astro-code astro-code-themes github-light github-dark\" style=\"background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"markdown\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">name: diagram\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">description: Generate a grounded codebase diagram\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold\">---\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">Generate a comprehensive mermaid diagram showing this codebase as an ontology.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">Requirements:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> Output a .mmd file with the Mermaid diagram\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> Every node must correspond to actual code\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> Output a .naiad file with grounding metadata\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E36209;--shiki-dark:#FFAB70\">-\u003C/span>\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\"> The .naiad file is JSON: keys are node IDs, values are {file, lines}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#24292E;--shiki-dark:#E1E4E8\">Start by exploring the codebase structure, then build the diagram iteratively.\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"why-this-works\">Why this works\u003C/h2>\n\u003Cp>Most “diagram my codebase” prompts fail because they don’t constrain the output. The agent draws whatever looks reasonable, with no accountability.\u003C/p>\n\u003Cp>By requiring a separate grounding file, you create a verification mechanism. The agent has to commit to specific file paths and line numbers. If it can’t find real code to back a node, it either drops the node or the discrepancy becomes obvious.\u003C/p>\n\u003Cp>The result: diagrams you can actually use to navigate a codebase, not just admire once and forget.\u003C/p>",{"headings":66,"localImagePaths":89,"remoteImagePaths":90,"frontmatter":91,"imagePaths":92},[67,70,73,76,80,83,86],{"depth":26,"slug":68,"text":69},"the-prompt","The prompt",{"depth":26,"slug":71,"text":72},"what-you-get","What you get",{"depth":26,"slug":74,"text":75},"three-ways-to-use-this","Three ways to use this",{"depth":77,"slug":78,"text":79},3,"1-paste-the-prompt","1. Paste the prompt",{"depth":77,"slug":81,"text":82},"2-shell-alias","2. Shell alias",{"depth":77,"slug":84,"text":85},"3-agent-skill-ampclaude-code","3. Agent skill (Amp/Claude Code)",{"depth":26,"slug":87,"text":88},"why-this-works","Why this works",[],[],{"title":58,"date":15,"description":59,"pinned":17},[],"designing-a-diagramming-agent.md"]