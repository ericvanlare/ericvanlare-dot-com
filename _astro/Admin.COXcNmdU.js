import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.Cd_vQiNd.js";import{Header as O}from"./Header.BY7F4vXh.js";const o="http://localhost:8787",_="https://dash.cloudflare.com/?to=/:account/web-analytics";function L(){const[c,j]=i.useState(null),[d,b]=i.useState(""),[h,y]=i.useState(!1),[m,u]=i.useState(null),[f,k]=i.useState([]),[S,N]=i.useState(!1),[r,l]=i.useState(null),[g,a]=i.useState(null),[p,x]=i.useState(""),n=i.useCallback(async()=>{N(!0);try{const t=await(await fetch(`${o}/api/ai-mod/list`)).json();t.success&&k(t.data)}catch(s){console.error("Failed to load requests:",s)}finally{N(!1)}},[]);i.useEffect(()=>{c==="ai"&&n()},[c,n]);const R=async()=>{if(d.trim()){y(!0),u(null);try{const t=await(await fetch(`${o}/api/ai-mod/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:d})})).json();t.success?(u({success:!0,message:`Created issue #${t.data.issueNumber}`}),b(""),n()):u({success:!1,message:t.error||"Failed to submit"})}catch(s){u({success:!1,message:`Network error: ${s}`})}finally{y(!1)}}},C=async()=>{if(r?.prNumber){a(null);try{const t=await(await fetch(`${o}/api/ai-mod/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prNumber:r.prNumber})})).json();t.success?(a({success:!0,message:"Changes merged!"}),n(),l(null)):a({success:!1,message:t.error||"Failed to merge"})}catch(s){a({success:!1,message:`Network error: ${s}`})}}},$=async()=>{if(r?.prNumber){a(null);try{const t=await(await fetch(`${o}/api/ai-mod/reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prNumber:r.prNumber})})).json();t.success?(a({success:!0,message:"PR closed"}),n(),l(null)):a({success:!1,message:t.error||"Failed to reject"})}catch(s){a({success:!1,message:`Network error: ${s}`})}}},P=async()=>{if(!(!r||!p.trim())){a(null);try{const t=await(await fetch(`${o}/api/ai-mod/revise`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({issueNumber:r.issueNumber,prNumber:r.prNumber,originalDescription:r.description,feedback:p})})).json();t.success?(a({success:!0,message:`Created revision issue #${t.data.issueNumber}`}),x(""),n(),l(null)):a({success:!1,message:t.error||"Failed to revise"})}catch(s){a({success:!1,message:`Network error: ${s}`})}}},A=async()=>{if(r?.prNumber){a(null);try{const t=await(await fetch(`${o}/api/ai-mod/revert`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prNumber:r.prNumber,description:r.description})})).json();t.success?(a({success:!0,message:`Created revert issue #${t.data.issueNumber}`}),n(),l(null)):a({success:!1,message:t.error||"Failed to revert"})}catch(s){a({success:!1,message:`Network error: ${s}`})}}},w=s=>{switch(s){case"pending":return"‚è≥";case"building":return"üî®";case"preview_ready":return"üëÅÔ∏è";case"applied":return"‚úÖ";case"replaced":return"üîÑ";case"discarded":return"‚ùå";default:return"‚ùì"}},v=s=>{switch(s){case"pending":return"Waiting for Copilot";case"building":return"Building preview...";case"preview_ready":return"Ready to review";case"applied":return"Applied";case"replaced":return"Replaced";case"discarded":return"Discarded";default:return s}};return e.jsxs("main",{className:"min-h-screen px-6 sm:px-12 max-w-3xl mx-auto py-10 sm:py-12",children:[e.jsx(O,{}),e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-8",children:"Site management tools"}),e.jsxs("div",{className:"flex flex-col gap-3 max-w-xs",children:[e.jsx("button",{onClick:()=>j(c==="ai"?null:"ai"),className:"px-4 py-3 text-left rounded-lg bg-purple-600 hover:bg-purple-700 text-white font-medium transition-colors",children:"ü§ñ Modify Site with AI"}),e.jsx("a",{href:_,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-3 text-center rounded-lg bg-amber-500 hover:bg-amber-600 text-white font-medium transition-colors",children:"üìä View Analytics"})]}),c==="ai"&&e.jsxs("div",{className:"mt-8 p-6 bg-purple-50 dark:bg-purple-950/30 rounded-lg max-w-2xl",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"ü§ñ Modify Site with AI"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Describe what you want to change. Copilot will create a PR with the changes for you to review."}),e.jsxs("details",{open:!0,className:"mb-6",children:[e.jsx("summary",{className:"cursor-pointer font-medium text-gray-900 dark:text-gray-100 py-2",children:"‚ûï New Request"}),e.jsxs("div",{className:"pt-2",children:[e.jsx("textarea",{value:d,onChange:s=>b(s.target.value),placeholder:"e.g., Add a dark mode toggle to the header...",rows:3,className:"w-full p-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 resize-y"}),e.jsx("button",{onClick:R,disabled:h||!d.trim(),className:"mt-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors",children:h?"Submitting...":"üöÄ Submit Request"}),m&&e.jsx("span",{className:`ml-3 text-sm ${m.success?"text-green-600":"text-red-600"}`,children:m.message})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:"üìã Previous Requests"}),e.jsx("button",{onClick:n,className:"px-2 py-1 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded",children:"‚Üª Refresh"})]}),S?e.jsx("p",{className:"text-gray-500",children:"Loading..."}):f.length===0?e.jsx("p",{className:"text-gray-500",children:"No requests yet. Submit one above!"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:f.map(s=>e.jsx("div",{onClick:()=>{l(s),a(null),x("")},className:`p-3 bg-white dark:bg-gray-900 rounded-lg cursor-pointer border-l-4 hover:shadow-sm transition-shadow ${s.status==="applied"?"border-green-500":s.status==="preview_ready"?"border-purple-500":s.status==="pending"?"border-amber-500":s.status==="building"?"border-blue-500":"border-gray-300"} ${s.issueState==="closed"?"opacity-60":""}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("strong",{className:"text-gray-900 dark:text-gray-100",children:[w(s.status)," ",s.description]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["#",s.issueNumber," ‚Ä¢ ",v(s.status)]})]}),s.previewUrl&&e.jsx("span",{className:"text-xs text-purple-600",children:"Preview ‚úì"})]})},s.issueNumber))})]}),r&&e.jsxs("div",{className:"mt-6 p-4 bg-white dark:bg-gray-900 rounded-lg border-2 border-purple-500",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r.description}),e.jsx("button",{onClick:()=>l(null),className:"text-gray-500 hover:text-gray-700",children:"‚úï"})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:[w(r.status)," ",v(r.status)]}),r.previewUrl&&r.status==="preview_ready"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Preview:"}),e.jsxs("div",{className:"border-2 border-purple-300 rounded overflow-hidden",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-xs px-2 py-1",children:"‚ö†Ô∏è Preview of proposed changes"}),e.jsx("iframe",{src:r.previewUrl,className:"w-full h-64 border-none",title:"Preview"})]}),e.jsx("a",{href:r.previewUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-purple-600 hover:underline mt-1 inline-block",children:"Open preview in new tab ‚Üí"})]}),(r.status==="preview_ready"||r.status==="building")&&e.jsxs("div",{className:"mb-4 p-3 bg-purple-50 dark:bg-purple-950/50 rounded",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"‚úèÔ∏è Request Changes"}),e.jsx("textarea",{value:p,onChange:s=>x(s.target.value),placeholder:"e.g., Make the button bigger...",rows:2,className:"w-full p-2 text-sm border border-gray-300 dark:border-gray-700 rounded bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100"}),e.jsx("button",{onClick:P,disabled:!p.trim(),className:"mt-2 px-3 py-1 text-sm bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded",children:"Request Changes"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.issueUrl&&e.jsx("a",{href:r.issueUrl,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:"View Issue"}),r.prUrl&&e.jsx("a",{href:r.prUrl,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:"View PR"}),(r.status==="preview_ready"||r.status==="building")&&r.prNumber&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:C,className:"px-3 py-1 text-sm bg-green-600 hover:bg-green-700 text-white rounded",children:"‚úÖ Approve & Merge"}),e.jsx("button",{onClick:$,className:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 text-white rounded",children:"‚ùå Reject"})]}),r.status==="applied"&&r.prNumber&&e.jsx("button",{onClick:A,className:"px-3 py-1 text-sm bg-amber-500 hover:bg-amber-600 text-white rounded",children:"‚Ü©Ô∏è Revert"})]}),g&&e.jsx("p",{className:`mt-3 text-sm ${g.success?"text-green-600":"text-red-600"}`,children:g.message})]})]})]})}export{L as default};
